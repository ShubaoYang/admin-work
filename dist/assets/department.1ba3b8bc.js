var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{p as u,h as i}from"./index.f4123b17.js";import{u as s,a as d,d as v}from"./table.35a7af36.js";import{_ as p}from"./lodash.92b17340.js";import{d as m,A as c,B as f,n as b,aA as y,m as g,X as h,g as k,aB as I,aT as O,aS as C,aX as D,U as w,r as j,o as F,c as U,a as x,w as A}from"./vendor.9a8d1981.js";const P=[{key:"name",label:"姓名",value:g(null),render:e=>b(I,{value:e.value.value,onUpdateValue:a=>{e.value.value=a}})},{key:"gender",label:"性别",value:g(1),selectOptions:[{label:"男",value:0},{label:"女",value:1}],render:e=>b(C,{onUpdateValue:a=>{e.value.value=a},value:e.value.value,name:e.key},{default:()=>{var a;return null==(a=e.optionItems)?void 0:a.map((e=>b(O,{value:e.value},{default:()=>e.label})))}})},{key:"address",label:"地区",value:g("0"),render:e=>b(D,{value:e.value.value,onUpdateValue:a=>{e.value.value=a},options:e.optionItems}),optionItems:[{value:"0",label:"第一个"},{value:"1",label:"第二个"},{value:"2",label:"第三个"}]}],_=[{key:"parentId",label:"父级部门",value:g(null),optionItems:w([]),render:e=>b(D,{value:e.value.value,onUpdateValue:a=>{e.value.value=a},placeholder:"请选择父级部门",options:e.optionItems})},{key:"name",label:"部门名称",type:"input",value:g(null),render:e=>b(I,{value:e.value.value,onUpdateValue:a=>{e.value.value=a},maxlength:50,placeholder:"请输入部门名称"}),validator:(e,a)=>!!e.value.value||(a.error("请输入部门名称"),!1)},{label:"部门编号",key:"depCode",value:g(null),render:e=>b(I,{value:e.value.value,onUpdateValue:a=>{e.value.value=a},placeholder:"请输入部门编号"},{prefix:()=>"dp_code_"}),validator:(e,a)=>!!e.value.value||(a.error("请输入部门编号"),!1)}];var T=m({name:"Department",setup(){const e=s(),m=c(),I=f(),O=d([{title:"部门名称",key:"name"},{title:"部门编号",key:"depCode"},{title:"排序",key:"order"},{title:"状态",key:"status",render:e=>b(y,{value:!!e.status})},{title:"操作",key:"actions",render:e=>v([{label:"编辑",onClick:x.bind(null,e)},{label:"删除",type:"error",onClick(){U(e)}}])}],{align:"center"}),C=g(null),D=g(null),w=g(null),j=u;function F(e,a){for(let l=0;l<e.length;l++){const t=e[l];if(t.id===a.id)return p.isEmpty(t.children)?void e.splice(l,1):void m.error("当前部门下有子部门，不能删除");p.isEmpty(t.children)||F(t.children,a)}}const U=a=>{I.warning({title:"提示",content:"确定要删除此信息，删除后不可恢复？",positiveText:"删除",negativeText:"再想想",onPositiveClick:()=>{F(e.dataList,a)}})};function x(e){var a;null==(a=w.value)||a.toggle(),h((()=>{_.forEach((a=>{const l=a.key,t=e[l];t&&("depCode"===a.key?a.value.value=t.replace("dp_code_",""):a.value.value=t)}))}))}return k((function(){j({url:i}).then(e.handleSuccess).then((e=>{var a;const l=_.find((e=>"parentId"===e.key));l.optionItems.length=0,null==(a=null==l?void 0:l.optionItems)||a.push(...e.map((e=>({label:e.name,value:e.id}))))}))})),A=((e,a)=>{for(var l in a||(a={}))n.call(a,l)&&r(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&r(e,l,a[l]);return e})({itemDataFormRef:C,searchDataFormRef:D,onDataFormConfirm:function(){var e,a;(null==(e=C.value)?void 0:e.validator())&&(null==(a=w.value)||a.toggle(),I.success({title:"提示",positiveText:"确定",content:"模拟部门添加/编辑成功，数据为："+JSON.stringify(C.value.generatorParams())}))},tableColumns:O,onUpdateItem:x},e),a(A,l({onDeleteItem:U,onAddItem:function(){var e;null==(e=w.value)||e.toggle(),h((()=>{var e;null==(e=C.value)||e.reset()}))},searchOptions:P,itemFormOptions:_,rowKey:function(e){return e.id},modalDialog:w}));var A}});const V={class:"main-container"};T.render=function(e,a,l,t,n,o){const r=j("AddButton"),u=j("TableHeader"),i=j("n-data-table"),s=j("TableBody"),d=j("DataForm"),v=j("ModalDialog");return F(),U("div",V,[x(u,{"show-filter":!1},{"top-right":A((()=>[x(r,{onAdd:e.onAddItem},null,8,["onAdd"])])),_:1}),x(s,null,{default:A((()=>[x(i,{loading:e.tableLoading,data:e.dataList,columns:e.tableColumns,"row-key":e.rowKey},null,8,["loading","data","columns","row-key"])])),_:1}),x(v,{ref:"modalDialog",onConfirm:e.onDataFormConfirm},{content:A((()=>[x(d,{ref:"itemDataFormRef",options:e.itemFormOptions},null,8,["options"])])),_:1},8,["onConfirm"])])};export default T;

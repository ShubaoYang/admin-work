var V=Object.defineProperty,j=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var b=(e,u,n)=>u in e?V(e,u,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[u]=n,B=(e,u)=>{for(var n in u||(u={}))M.call(u,n)&&b(e,n,u[n]);if(y)for(var n of y(u))O.call(u,n)&&b(e,n,u[n]);return e},A=(e,u)=>j(e,x(u));import{p as P,h as S}from"./index.84f8988a.js";import{a as U,c as $,d as H}from"./table.3aa45a9e.js";import{_ as T}from"./lodash.8f895181.js";import{d as K,A as G,B as J,l as m,aD as W,k as s,_ as w,e as q,W as z,a_ as Q,aE as I,r as i,o as X,c as Y,a as d,w as g}from"./vendor.2777dd0c.js";function Z(){return P}const N="dp_code_",h=[{key:"parentId",label:"\u7236\u7EA7\u90E8\u95E8",value:s(null),optionItems:z([]),render:e=>m(Q,{value:e.value.value,onUpdateValue:u=>{e.value.value=u},placeholder:"\u8BF7\u9009\u62E9\u7236\u7EA7\u90E8\u95E8",options:e.optionItems})},{key:"name",label:"\u90E8\u95E8\u540D\u79F0",type:"input",value:s(null),render:e=>m(I,{value:e.value.value,onUpdateValue:u=>{e.value.value=u},maxlength:50,placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0"}),validator:(e,u)=>e.value.value?!0:(u.error("\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0"),!1)},{label:"\u90E8\u95E8\u7F16\u53F7",key:"depCode",value:s(null),render:e=>m(I,{value:e.value.value,onUpdateValue:u=>{e.value.value=u},placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u7F16\u53F7"},{prefix:()=>N}),validator:(e,u)=>e.value.value?!0:(u.error("\u8BF7\u8F93\u5165\u90E8\u95E8\u7F16\u53F7"),!1)}];var ee=K({name:"Department",setup(){const e=U(),u=G(),n=J(),_=$([{title:"\u90E8\u95E8\u540D\u79F0",key:"name"},{title:"\u90E8\u95E8\u7F16\u53F7",key:"depCode"},{title:"\u6392\u5E8F",key:"order"},{title:"\u72B6\u6001",key:"status",render:t=>m(W,{defaultValue:!!t.status})},{title:"\u64CD\u4F5C",key:"actions",render:t=>H([{label:"\u7F16\u8F91",onClick:k.bind(null,t)},{label:"\u5220\u9664",type:"error",onClick(){F(t)}}])}],{align:"center"}),c=s(null),C=s(null),r=s(null),v=Z();function E(){v({url:S}).then(e.handleSuccess).then(t=>{var o;const a=h.find(l=>l.key==="parentId");a.optionItems.length=0,(o=a==null?void 0:a.optionItems)==null||o.push(...t.map(l=>({label:l.name,value:l.id})))})}function p(t,a){for(let o=0;o<t.length;o++){const l=t[o];if(l.id===a.id){if(!T.isEmpty(l.children)){u.error("\u5F53\u524D\u90E8\u95E8\u4E0B\u6709\u5B50\u90E8\u95E8\uFF0C\u4E0D\u80FD\u5220\u9664");return}t.splice(o,1);return}else T.isEmpty(l.children)||p(l.children,a)}}const F=t=>{n.warning({title:"\u63D0\u793A",content:"\u786E\u5B9A\u8981\u5220\u9664\u6B64\u4FE1\u606F\uFF0C\u5220\u9664\u540E\u4E0D\u53EF\u6062\u590D\uFF1F",positiveText:"\u5220\u9664",negativeText:"\u518D\u60F3\u60F3",onPositiveClick:()=>{p(e.dataList,t)}})};function f(){var t;(t=r.value)==null||t.toggle(),w(()=>{var a;(a=c.value)==null||a.reset()})}function R(){var t,a;((t=c.value)==null?void 0:t.validator())&&((a=r.value)==null||a.toggle(),n.success({title:"\u63D0\u793A",positiveText:"\u786E\u5B9A",content:"\u6A21\u62DF\u90E8\u95E8\u6DFB\u52A0/\u7F16\u8F91\u6210\u529F\uFF0C\u6570\u636E\u4E3A\uFF1A"+JSON.stringify(c.value.generatorParams())}))}function k(t){var a;(a=r.value)==null||a.toggle(),w(()=>{h.forEach(o=>{const l=o.key,D=t[l];D&&(o.key==="depCode"?o.value.value=D.replace(N,""):o.value.value=D)})})}function L(t){return t.id}return q(E),A(B({itemDataFormRef:c,searchDataFormRef:C,onDataFormConfirm:R,tableColumns:_,onUpdateItem:k},e),{onDeleteItem:F,onAddItem:f,itemFormOptions:h,rowKey:L,modalDialog:r})}});const ue={class:"main-container"};function te(e,u,n,_,c,C){const r=i("AddButton"),v=i("TableHeader"),E=i("n-data-table"),p=i("TableBody"),F=i("DataForm"),f=i("ModalDialog");return X(),Y("div",ue,[d(v,{"show-filter":!1},{"top-right":g(()=>[d(r,{onAdd:e.onAddItem},null,8,["onAdd"])]),_:1}),d(p,null,{default:g(()=>[d(E,{loading:e.tableLoading,data:e.dataList,columns:e.tableColumns,"row-key":e.rowKey},null,8,["loading","data","columns","row-key"])]),_:1}),d(f,{ref:"modalDialog",onConfirm:e.onDataFormConfirm},{content:g(()=>[d(F,{ref:"itemDataFormRef",options:e.itemFormOptions},null,8,["options"])]),_:1},8,["onConfirm"])])}ee.render=te;export{ee as default};

var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{p as i,h as u}from"./index.8fec47f7.js";import{u as d,a as s,d as v}from"./table.d6971653.js";import{_ as p}from"./lodash.f0e757d9.js";import{d as c,A as m,B as f,l as y,aC as b,k as g,Z as h,e as k,V as C,aZ as D,aD as O,r as w,o as I,c as j,a as F,w as x}from"./vendor.f7361d5e.js";const P=[{key:"parentId",label:"父级部门",value:g(null),optionItems:C([]),render:e=>y(D,{value:e.value.value,onUpdateValue:a=>{e.value.value=a},placeholder:"请选择父级部门",options:e.optionItems})},{key:"name",label:"部门名称",type:"input",value:g(null),render:e=>y(O,{value:e.value.value,onUpdateValue:a=>{e.value.value=a},maxlength:50,placeholder:"请输入部门名称"}),validator:(e,a)=>!!e.value.value||(a.error("请输入部门名称"),!1)},{label:"部门编号",key:"depCode",value:g(null),render:e=>y(O,{value:e.value.value,onUpdateValue:a=>{e.value.value=a},placeholder:"请输入部门编号"},{prefix:()=>"dp_code_"}),validator:(e,a)=>!!e.value.value||(a.error("请输入部门编号"),!1)}];var _=c({name:"Department",setup(){const e=d(),c=m(),C=f(),D=s([{title:"部门名称",key:"name"},{title:"部门编号",key:"depCode"},{title:"排序",key:"order"},{title:"状态",key:"status",render:e=>y(b,{defaultValue:!!e.status})},{title:"操作",key:"actions",render:e=>v([{label:"编辑",onClick:_.bind(null,e)},{label:"删除",type:"error",onClick(){x(e)}}])}],{align:"center"}),O=g(null),w=g(null),I=g(null),j=i;function F(e,a){for(let l=0;l<e.length;l++){const t=e[l];if(t.id===a.id)return p.isEmpty(t.children)?void e.splice(l,1):void c.error("当前部门下有子部门，不能删除");p.isEmpty(t.children)||F(t.children,a)}}const x=a=>{C.warning({title:"提示",content:"确定要删除此信息，删除后不可恢复？",positiveText:"删除",negativeText:"再想想",onPositiveClick:()=>{F(e.dataList,a)}})};function _(e){var a;null==(a=I.value)||a.toggle(),h((()=>{P.forEach((a=>{const l=a.key,t=e[l];t&&("depCode"===a.key?a.value.value=t.replace("dp_code_",""):a.value.value=t)}))}))}return k((function(){j({url:u}).then(e.handleSuccess).then((e=>{var a;const l=P.find((e=>"parentId"===e.key));l.optionItems.length=0,null==(a=null==l?void 0:l.optionItems)||a.push(...e.map((e=>({label:e.name,value:e.id}))))}))})),A=((e,a)=>{for(var l in a||(a={}))o.call(a,l)&&r(e,l,a[l]);if(t)for(var l of t(a))n.call(a,l)&&r(e,l,a[l]);return e})({itemDataFormRef:O,searchDataFormRef:w,onDataFormConfirm:function(){var e,a;(null==(e=O.value)?void 0:e.validator())&&(null==(a=I.value)||a.toggle(),C.success({title:"提示",positiveText:"确定",content:"模拟部门添加/编辑成功，数据为："+JSON.stringify(O.value.generatorParams())}))},tableColumns:D,onUpdateItem:_},e),a(A,l({onDeleteItem:x,onAddItem:function(){var e;null==(e=I.value)||e.toggle(),h((()=>{var e;null==(e=O.value)||e.reset()}))},itemFormOptions:P,rowKey:function(e){return e.id},modalDialog:I}));var A}});const A={class:"main-container"};_.render=function(e,a,l,t,o,n){const r=w("AddButton"),i=w("TableHeader"),u=w("n-data-table"),d=w("TableBody"),s=w("DataForm"),v=w("ModalDialog");return I(),j("div",A,[F(i,{"show-filter":!1},{"top-right":x((()=>[F(r,{onAdd:e.onAddItem},null,8,["onAdd"])])),_:1}),F(d,null,{default:x((()=>[F(u,{loading:e.tableLoading,data:e.dataList,columns:e.tableColumns,"row-key":e.rowKey},null,8,["loading","data","columns","row-key"])])),_:1}),F(v,{ref:"modalDialog",onConfirm:e.onDataFormConfirm},{content:x((()=>[F(s,{ref:"itemDataFormRef",options:e.itemFormOptions},null,8,["options"])])),_:1},8,["onConfirm"])])};export default _;

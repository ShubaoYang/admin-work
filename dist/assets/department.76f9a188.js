var N=Object.defineProperty,V=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var k=(e,u,a)=>u in e?N(e,u,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[u]=a,B=(e,u)=>{for(var a in u||(u={}))M.call(u,a)&&k(e,a,u[a]);if(C)for(var a of C(u))O.call(u,a)&&k(e,a,u[a]);return e},A=(e,u)=>V(e,x(u));import{p as P,h as U}from"./index.57a2f3c1.js";import{a as $,c as S,d as H}from"./table.26339955.js";import{_ as T}from"./lodash.cf6c591b.js";import{g as K}from"./form.c8a49cb2.js";import{d as z,y as G,A as J,k as s,Z as w,e as Z,V as q,l as D,a_ as Q,aE as I,r as i,o as W,c as X,a as d,w as g}from"./vendor.68c261ce.js";function Y(){return P}const R="dp_code_",h=[{key:"parentId",label:"\u7236\u7EA7\u90E8\u95E8",value:s(null),optionItems:q([]),render:e=>D(Q,{value:e.value.value,onUpdateValue:u=>{e.value.value=u},placeholder:"\u8BF7\u9009\u62E9\u7236\u7EA7\u90E8\u95E8",options:e.optionItems})},{key:"name",label:"\u90E8\u95E8\u540D\u79F0",type:"input",value:s(null),render:e=>D(I,{value:e.value.value,onUpdateValue:u=>{e.value.value=u},maxlength:50,placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0"}),validator:(e,u)=>e.value.value?!0:(u.error("\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0"),!1)},{label:"\u90E8\u95E8\u7F16\u53F7",key:"depCode",value:s(null),render:e=>D(I,{value:e.value.value,onUpdateValue:u=>{e.value.value=u},placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u7F16\u53F7"},{prefix:()=>R}),validator:(e,u)=>e.value.value?!0:(u.error("\u8BF7\u8F93\u5165\u90E8\u95E8\u7F16\u53F7"),!1)}];var ee=z({name:"Department",setup(){const e=$(),u=G(),a=J(),_=S([{title:"\u90E8\u95E8\u540D\u79F0",key:"name"},{title:"\u90E8\u95E8\u7F16\u53F7",key:"depCode"},{title:"\u6392\u5E8F",key:"order"},{title:"\u72B6\u6001",key:"status",render:t=>K(t.status?"\u6B63\u5E38":"\u7981\u7528",{type:t.status?"success":"error",size:"small"})},{title:"\u64CD\u4F5C",key:"actions",render:t=>H([{label:"\u7F16\u8F91",onClick:b.bind(null,t)},{label:"\u5220\u9664",type:"error",onClick(){m(t)}}])}],{align:"center"}),c=s(null),y=s(null),r=s(null),F=Y();function v(){F({url:U}).then(e.handleSuccess).then(t=>{var o;const n=h.find(l=>l.key==="parentId");n.optionItems.length=0,(o=n==null?void 0:n.optionItems)==null||o.push(...t.map(l=>({label:l.name,value:l.id})))})}function p(t,n){for(let o=0;o<t.length;o++){const l=t[o];if(l.id===n.id){if(!T.isEmpty(l.children)){u.error("\u5F53\u524D\u90E8\u95E8\u4E0B\u6709\u5B50\u90E8\u95E8\uFF0C\u4E0D\u80FD\u5220\u9664");return}t.splice(o,1);return}else T.isEmpty(l.children)||p(l.children,n)}}const m=t=>{a.warning({title:"\u63D0\u793A",content:"\u786E\u5B9A\u8981\u5220\u9664\u6B64\u4FE1\u606F\uFF0C\u5220\u9664\u540E\u4E0D\u53EF\u6062\u590D\uFF1F",positiveText:"\u5220\u9664",negativeText:"\u518D\u60F3\u60F3",onPositiveClick:()=>{p(e.dataList,t)}})};function E(){var t;(t=r.value)==null||t.toggle(),w(()=>{var n;(n=c.value)==null||n.reset()})}function j(){var t,n;((t=c.value)==null?void 0:t.validator())&&((n=r.value)==null||n.toggle(),a.success({title:"\u63D0\u793A",positiveText:"\u786E\u5B9A",content:"\u6A21\u62DF\u90E8\u95E8\u6DFB\u52A0/\u7F16\u8F91\u6210\u529F\uFF0C\u6570\u636E\u4E3A\uFF1A"+JSON.stringify(c.value.generatorParams())}))}function b(t){var n;(n=r.value)==null||n.toggle(),w(()=>{h.forEach(o=>{const l=o.key,f=t[l];f&&(o.key==="depCode"?o.value.value=f.replace(R,""):o.value.value=f)})})}function L(t){return t.id}return Z(v),A(B({itemDataFormRef:c,searchDataFormRef:y,onDataFormConfirm:j,tableColumns:_,onUpdateItem:b},e),{onDeleteItem:m,onAddItem:E,itemFormOptions:h,rowKey:L,modalDialog:r})}});const ue={class:"main-container"};function te(e,u,a,_,c,y){const r=i("AddButton"),F=i("TableHeader"),v=i("n-data-table"),p=i("TableBody"),m=i("DataForm"),E=i("ModalDialog");return W(),X("div",ue,[d(F,{"show-filter":!1},{"top-right":g(()=>[d(r,{onAdd:e.onAddItem},null,8,["onAdd"])]),_:1}),d(p,null,{default:g(()=>[d(v,{loading:e.tableLoading,data:e.dataList,columns:e.tableColumns,"row-key":e.rowKey},null,8,["loading","data","columns","row-key"])]),_:1}),d(E,{ref:"modalDialog",onConfirm:e.onDataFormConfirm},{content:g(()=>[d(m,{ref:"itemDataFormRef",options:e.itemFormOptions},null,8,["options"])]),_:1},8,["onConfirm"])])}ee.render=te;export{ee as default};
